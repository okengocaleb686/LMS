<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System | LMS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ============================================
           LMS - LIBRARY MANAGEMENT SYSTEM
           Combined CSS Styles
           ============================================ */
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --primary-dark: #764ba2;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #06b6d4;
            --light-bg: #f8fafc;
            --white: #ffffff;
            --dark: #1e293b;
            --border-color: #e2e8f0;
            --text-primary: #334155;
            --text-secondary: #64748b;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        a { text-decoration: none; color: var(--primary-color); transition: var(--transition); }
        a:hover { color: var(--primary-dark); }

        /* ========== LOGIN PAGE STYLES ========== */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            padding: 20px;
        }

        .login-container {
            background: var(--white);
            padding: 40px;
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 420px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .login-logo svg {
            width: 100px;
            height: 100px;
        }

        .login-container h1 {
            text-align: center;
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 26px;
        }

        .login-container .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-with-icon {
            position: relative;
            margin-bottom: 20px;
        }

        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .input-with-icon input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            transition: var(--transition);
        }

        .input-with-icon input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--white);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: var(--white);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #c0392b 100%);
            color: var(--white);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
            color: var(--white);
        }

        .btn-block { width: 100%; }
        .btn-sm { padding: 8px 16px; font-size: 12px; }

        .login-divider {
            display: flex;
            align-items: center;
            margin: 25px 0;
        }

        .login-divider::before, .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
        }

        .login-divider span {
            padding: 0 15px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .demo-accounts {
            margin-top: 25px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: var(--radius);
            border: 1px solid #bae6fd;
        }

        .demo-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 13px;
        }

        .demo-account {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #bae6fd;
        }

        .demo-account:last-child { border-bottom: none; }

        .demo-role {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .demo-credentials {
            font-size: 11px;
            color: var(--dark);
            font-family: monospace;
            background: var(--white);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* ========== DASHBOARD LAYOUT ========== */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--dark);
            color: var(--white);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 100;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-header svg {
            width: 40px;
            height: 40px;
        }

        .sidebar-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.7);
            transition: var(--transition);
            cursor: pointer;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border-left: 3px solid var(--primary-color);
        }

        .sidebar-nav i {
            width: 24px;
            font-size: 18px;
            margin-right: 12px;
        }

        .sidebar-section {
            padding: 10px 20px 5px;
            font-size: 11px;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.4);
            font-weight: 600;
            letter-spacing: 1px;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: absolute;
            bottom: 0;
            width: 100%;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }

        .user-details h4 {
            font-size: 14px;
            font-weight: 500;
        }

        .user-details span {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 20px;
        }

        /* ========== HEADER ========== */
        .header {
            background: var(--white);
            padding: 20px 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            color: var(--dark);
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        .header-icon:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: var(--white);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        /* ========== STATS CARDS ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-icon.blue { background: #dbeafe; color: #2563eb; }
        .stat-icon.green { background: #d1fae5; color: #10b981; }
        .stat-icon.orange { background: #fef3c7; color: #f59e0b; }
        .stat-icon.purple { background: #ede9fe; color: #7c3aed; }
        .stat-icon.red { background: #fee2e2; color: #ef4444; }

        .stat-info h3 {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-info p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* ========== CARDS ========== */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 18px;
            color: var(--dark);
        }

        .card-body {
            padding: 20px;
        }

        /* ========== QUICK ACTIONS ========== */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .quick-action {
            background: var(--light-bg);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .quick-action:hover {
            background: var(--white);
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }

        .quick-action i {
            font-size: 28px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .quick-action h4 {
            font-size: 14px;
            color: var(--dark);
        }

        /* ========== TABLES ========== */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: var(--white);
            font-weight: 600;
        }

        tr:hover {
            background: var(--light-bg);
        }

        .status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active, .status-issued { background: #d1fae5; color: #065f46; }
        .status-inactive { background: #fee2e2; color: #991b1b; }
        .status-returned { background: #dbeafe; color: #1e40af; }

        .actions {
            display: flex;
            gap: 8px;
        }

        .actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: var(--transition);
        }

        .actions .edit-btn { background: #dbeafe; color: #2563eb; }
        .actions .delete-btn { background: #fee2e2; color: #ef4444; }
        .actions .view-btn { background: #d1fae5; color: #10b981; }

        /* ========== FORMS ========== */
        .form-container {
            max-width: 700px;
            margin: 0 auto;
            background: var(--white);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            transition: var(--transition);
            background: var(--white);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* ========== MODAL ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 18px;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* ========== TOAST NOTIFICATIONS ========== */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .toast {
            background: var(--white);
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            min-width: 250px;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left: 4px solid var(--success-color); }
        .toast.error { border-left: 4px solid var(--danger-color); }
        .toast.warning { border-left: 4px solid var(--warning-color); }
        .toast.info { border-left: 4px solid var(--info-color); }

        /* ========== SEARCH ========== */
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-box input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* ========== ALERTS ========== */
        .alert {
            padding: 12px 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 60px;
            color: var(--border-color);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 20px;
            color: var(--dark);
            margin-bottom: 10px;
        }

        /* ========== BOOK GRID ========== */
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .book-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .book-cover {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 48px;
        }

        .book-info {
            padding: 15px;
        }

        .book-info h4 {
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .book-info p {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .book-info .availability {
            font-size: 12px;
            font-weight: 500;
        }

        .book-info .availability.available { color: var(--success-color); }
        .book-info .availability.unavailable { color: var(--danger-color); }

        /* ========== PAGE SECTIONS ========== */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .form-row {
                flex-direction: column;
            }
            .header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Login Page -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <div class="login-logo">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="url(#logoGrad)" />
                    <path d="M30 25h40c2 0 4 2 4 4v42c0 2-2 4-4 4H30c-2 0-4-2-4-4V29c0-2 2-4 4-4z" fill="white" />
                    <rect x="35" y="35" width="30" height="4" rx="2" fill="#667eea" />
                    <rect x="35" y="45" width="25" height="4" rx="2" fill="#764ba2" />
                    <rect x="35" y="55" width="20" height="4" rx="2" fill="#667eea" />
                    <path d="M65 65v10M60 70h10" stroke="white" stroke-width="3" stroke-linecap="round" />
                    <defs>
                        <linearGradient id="logoGrad" x1="0" y1="0" x2="100" y2="100">
                            <stop offset="0%" stop-color="#667eea" />
                            <stop offset="100%" stop-color="#764ba2" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h1>Library Management System</h1>
            <p class="subtitle">Sign in to access your library account</p>
            
            <div id="login-alert"></div>
            
            <form id="login-form">
                <div class="input-with-icon">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="login-email" placeholder="Enter your email" required>
                </div>
                
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="login-password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
                
                <div class="login-divider"><span>OR</span></div>
                
                <button type="button" id="admin-login-btn" class="btn btn-secondary btn-block">
                    <i class="fas fa-user-shield"></i> Quick Admin Login
                </button>
            </form>
            
            <p style="text-align: center; margin-top: 20px; color: var(--text-secondary);">
                Don't have an account? 
                <a href="#" onclick="Router.navigate('register')" class="link-primary">Register here</a>
            </p>
            
            <div class="demo-accounts">
                <div class="demo-title"><i class="fas fa-info-circle"></i> Demo Accounts</div>
                <div class="demo-account">
                    <span class="demo-role"><i class="fas fa-user-shield"></i> Admin</span>
                    <span class="demo-credentials">admin@lms.com / admin123</span>
                </div>
                <div class="demo-account">
                    <span class="demo-role"><i class="fas fa-user"></i> User</span>
                    <span class="demo-credentials">user@lms.com / user123</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="register-page" class="login-page" style="display: none;">
        <div class="login-container">
            <div class="login-logo">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="url(#logoGrad2)" />
                    <path d="M30 25h40c2 0 4 2 4 4v42c0 2-2 4-4 4H30c-2 0-4-2-4-4V29c0-2 2-4 4-4z" fill="white" />
                    <rect x="35" y="35" width="30" height="4" rx="2" fill="#667eea" />
                    <rect x="35" y="45" width="25" height="4" rx="2" fill="#764ba2" />
                    <rect x="35" y="55" width="20" height="4" rx="2" fill="#667eea" />
                    <path d="M65 65v10M60 70h10" stroke="white" stroke-width="3" stroke-linecap="round" />
                    <defs>
                        <linearGradient id="logoGrad2" x1="0" y1="0" x2="100" y2="100">
                            <stop offset="0%" stop-color="#667eea" />
                            <stop offset="100%" stop-color="#764ba2" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h1>Create Account</h1>
            <p class="subtitle">Register to access the library</p>
            
            <div id="register-alert"></div>
            
            <form id="register-form">
                <div class="input-with-icon">
                    <i class="fas fa-user"></i>
                    <input type="text" id="reg-name" placeholder="Full Name" required>
                </div>
                
                <div class="input-with-icon">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="reg-email" placeholder="Email Address" required>
                </div>
                
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="reg-password" placeholder="Password" required>
                </div>
                
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="reg-confirm-password" placeholder="Confirm Password" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </form>
            
            <p style="text-align: center; margin-top: 20px; color: var(--text-secondary);">
                Already have an account? 
                <a href="#" onclick="Router.navigate('login')" class="link-primary">Login here</a>
            </p>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div id="dashboard-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="50" r="45" fill="url(#logoGrad3)" />
                    <path d="M30 25h40c2 0 4 2 4 4v42c0 2-2 4-4 4H30c-2 0-4-2-4-4V29c0-2 2-4 4-4z" fill="white" />
                    <rect x="35" y="35" width="30" height="4" rx="2" fill="#667eea" />
                    <rect x="35" y="45" width="25" height="4" rx="2" fill="#764ba2" />
                    <rect x="35" y="55" width="20" height="4" rx="2" fill="#667eea" />
                    <path d="M65 65v10M60 70h10" stroke="white" stroke-width="3" stroke-linecap="round" />
                    <defs>
                        <linearGradient id="logoGrad3" x1="0" y1="0" x2="100" y2="100">
                            <stop offset="0%" stop-color="#667eea" />
                            <stop offset="100%" stop-color="#764ba2" />
                        </linearGradient>
                    </defs>
                </svg>
                <h2>LMS</h2>
            </div>
            <nav class="sidebar-nav" id="sidebar-nav"></nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">A</div>
                    <div class="user-details">
                        <h4 id="user-name">Admin User</h4>
                        <span id="user-role">Administrator</span>
                    </div>
                </div>
                <button onclick="Auth.logout()" class="btn btn-danger btn-sm btn-block" style="margin-top: 15px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <div class="header-icon" onclick="Router.navigate('notifications')">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notif-count">3</span>
                    </div>
                    <div class="header-icon" onclick="Router.navigate('profile')">
                        <i class="fas fa-user-circle"></i>
                    </div>
                </div>
            </div>

            <!-- Admin Dashboard -->
            <div id="admin-dashboard" class="page-section">
                <div class="stats-grid" id="stats-grid"></div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="quick-actions">
                            <div class="quick-action" onclick="Router.navigate('add-book')">
                                <i class="fas fa-plus-circle"></i>
                                <h4>Add Book</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('add-author')">
                                <i class="fas fa-user-plus"></i>
                                <h4>Add Author</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('add-category')">
                                <i class="fas fa-tag"></i>
                                <h4>Add Category</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('issue-book')">
                                <i class="fas fa-clipboard"></i>
                                <h4>Issue Book</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('analytics')">
                                <i class="fas fa-chart-line"></i>
                                <h4>Analytics</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('users')">
                                <i class="fas fa-users"></i>
                                <h4>Users</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('manage-books')">
                                <i class="fas fa-book"></i>
                                <h4>Manage Books</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('issued-books')">
                                <i class="fas fa-clipboard-check"></i>
                                <h4>Issued Books</h4>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Book Issues</h3>
                            <a href="#" onclick="Router.navigate('issued-books')" class="btn btn-sm btn-secondary">View All</a>
                        </div>
                        <div class="card-body">
                            <div id="recent-issues"></div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Users</h3>
                            <a href="#" onclick="Router.navigate('users')" class="btn btn-sm btn-secondary">View All</a>
                        </div>
                        <div class="card-body">
                            <div id="recent-users"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Dashboard -->
            <div id="user-dashboard" class="page-section">
                <div class="stats-grid" id="user-stats-grid"></div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="quick-actions">
                            <div class="quick-action" onclick="Router.navigate('browse-books')">
                                <i class="fas fa-book-open"></i>
                                <h4>Browse Books</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('search')">
                                <i class="fas fa-search-plus"></i>
                                <h4>Search Books</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('my-issued')">
                                <i class="fas fa-clipboard-list"></i>
                                <h4>My Issued Books</h4>
                            </div>
                            <div class="quick-action" onclick="Router.navigate('profile')">
                                <i class="fas fa-user"></i>
                                <h4>My Profile</h4>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>My Issued Books</h3>
                    </div>
                    <div class="card-body">
                        <div id="my-issued-books"></div>
                    </div>
                </div>
            </div>

            <!-- Manage Books Page -->
            <div id="manage-books-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>Manage Books</h3>
                        <button class="btn btn-primary btn-sm" onclick="Router.navigate('add-book')">
                            <i class="fas fa-plus"></i> Add Book
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="search-box">
                            <input type="text" id="book-search" placeholder="Search books..." onkeyup="Books.search()">
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Author</th>
                                        <th>Category</th>
                                        <th>ISBN</th>
                                        <th>Available</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="books-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Browse Books Page -->
            <div id="browse-books-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>Browse Books</h3>
                    </div>
                    <div class="card-body">
                        <div class="search-box">
                            <input type="text" id="browse-search" placeholder="Search by title, author, or ISBN..." onkeyup="Books.browseSearch()">
                        </div>
                        <div class="books-grid" id="books-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Search Page -->
            <div id="search-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>Advanced Search</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-container" style="max-width: 100%; box-shadow: none; padding: 0;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Title</label>
                                    <input type="text" id="search-title" placeholder="Book title">
                                </div>
                                <div class="form-group">
                                    <label>Author</label>
                                    <select id="search-author">
                                        <option value="">All Authors</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Category</label>
                                    <select id="search-category">
                                        <option value="">All Categories</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ISBN</label>
                                    <input type="text" id="search-isbn" placeholder="ISBN">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="Books.advancedSearch()">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                        <div id="search-results" style="margin-top: 30px;"></div>
                    </div>
                </div>
            </div>

            <!-- Add Book Page -->
            <div id="add-book-page" class="page-section">
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">Add New Book</h2>
                    <form id="add-book-form">
                        <div class="form-group">
                            <label>Title *</label>
                            <input type="text" id="book-title" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Author *</label>
                                <select id="book-author" required></select>
                            </div>
                            <div class="form-group">
                                <label>Category *</label>
                                <select id="book-category" required></select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ISBN *</label>
                                <input type="text" id="book-isbn" required>
                            </div>
                            <div class="form-group">
                                <label>Quantity *</label>
                                <input type="number" id="book-quantity" min="1" value="1" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="book-description" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> Add Book
                        </button>
                    </form>
                </div>
            </div>

            <!-- Add Author Page -->
            <div id="add-author-page" class="page-section">
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">Add New Author</h2>
                    <form id="add-author-form">
                        <div class="form-group">
                            <label>Author Name *</label>
                            <input type="text" id="author-name" required>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="author-email">
                        </div>
                        <div class="form-group">
                            <label>Bio</label>
                            <textarea id="author-bio" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> Add Author
                        </button>
                    </form>
                </div>
            </div>

            <!-- Add Category Page -->
            <div id="add-category-page" class="page-section">
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">Add New Category</h2>
                    <form id="add-category-form">
                        <div class="form-group">
                            <label>Category Name *</label>
                            <input type="text" id="category-name" required>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="category-description" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> Add Category
                        </button>
                    </form>
                </div>
            </div>

            <!-- Issue Book Page -->
            <div id="issue-book-page" class="page-section">
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">Issue Book</h2>
                    <form id="issue-book-form">
                        <div class="form-group">
                            <label>Select User *</label>
                            <select id="issue-user" required></select>
                        </div>
                        <div class="form-group">
                            <label>Select Book *</label>
                            <select id="issue-book" required></select>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-clipboard"></i> Issue Book
                        </button>
                    </form>
                </div>
            </div>

            <!-- Issued Books Page -->
            <div id="issued-books-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>Issued Books</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Book</th>
                                        <th>User</th>
                                        <th>Issue Date</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="issued-books-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Page -->
            <div id="users-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>Registered Users</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Issued Books Page -->
            <div id="my-issued-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>My Issued Books</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Book</th>
                                        <th>Issue Date</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="my-issued-table"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>Library Analytics</h3>
                    </div>
                    <div class="card-body">
                        <div class="reports-summary" id="analytics-stats"></div>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <h3>Books by Category</h3>
                        </div>
                        <div class="card-body" id="category-chart"></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Author Statistics</h3>
                        </div>
                        <div class="card-body" id="author-chart"></div>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="page-section">
                <div class="form-container">
                    <h2 style="margin-bottom: 20px;">My Profile</h2>
                    <form id="profile-form">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="profile-name" disabled>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="profile-email" disabled>
                        </div>
                        <div class="form-group">
                            <label>Role</label>
                            <input type="text" id="profile-role" disabled>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Notifications Page -->
            <div id="notifications-page" class="page-section">
                <div class="card">
                    <div class="card-header">
                        <h3>Notifications</h3>
                    </div>
                    <div class="card-body">
                        <div id="notifications-list">
                            <div class="empty-state">
                                <i class="fas fa-bell-slash"></i>
                                <h3>No Notifications</h3>
                                <p>You're all caught up!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Application -->
    <script>
        /**
         * ============================================
         * LMS - LIBRARY MANAGEMENT SYSTEM
         * Combined JavaScript Module
         * ============================================
         */

        // ==========================================
        // DATA MANAGER - Handles localStorage operations
        // ==========================================
        const DataManager = {
            STORAGE_KEYS: {
                USERS: 'lms_users',
                BOOKS: 'lms_books',
                AUTHORS: 'lms_authors',
                CATEGORIES: 'lms_categories',
                ISSUED_BOOKS: 'lms_issued_books',
                CURRENT_USER: 'lms_current_user',
                FINES: 'lms_fines',
                NOTIFICATIONS: 'lms_notifications'
            },

            init: function() {
                if (!localStorage.getItem(this.STORAGE_KEYS.INITIALIZED)) {
                    this.initializeSampleData();
                    localStorage.setItem(this.STORAGE_KEYS.INITIALIZED, 'true');
                }
            },

            initializeSampleData: function() {
                // Sample Authors
                const authors = [
                    { id: 1, name: 'J.K. Rowling', email: 'jkrowling@example.com', bio: 'British author, best known for the Harry Potter series.', created_at: new Date().toISOString() },
                    { id: 2, name: 'George Orwell', email: 'georgeorwell@example.com', bio: 'English novelist, essayist, and critic.', created_at: new Date().toISOString() },
                    { id: 3, name: 'Harper Lee', email: 'harperlee@example.com', bio: 'American novelist widely known for To Kill a Mockingbird.', created_at: new Date().toISOString() },
                    { id: 4, name: 'F. Scott Fitzgerald', email: 'fsfitzgerald@example.com', bio: 'American novelist, essayist, and short story writer.', created_at: new Date().toISOString() },
                    { id: 5, name: 'Jane Austen', email: 'janeausten@example.com', bio: 'English novelist known for romantic fiction.', created_at: new Date().toISOString() },
                    { id: 6, name: 'Mark Twain', email: 'marktwain@example.com', bio: 'American writer, humorist, and lecturer.', created_at: new Date().toISOString() },
                    { id: 7, name: 'Charles Dickens', email: 'charlesdickens@example.com', bio: 'English writer and social critic.', created_at: new Date().toISOString() },
                    { id: 8, name: 'Emily Bront', email: 'emilybronte@example.com', bio: 'English novelist and poet, best known for Wuthering Heights.', created_at: new Date().toISOString() }
                ];

                // Sample Categories
                const categories = [
                    { id: 1, name: 'Fantasy', description: 'Magical and mythical fictional works', created_at: new Date().toISOString() },
                    { id: 2, name: 'Science Fiction', description: 'Speculative fiction with technology and science themes', created_at: new Date().toISOString() },
                    { id: 3, name: 'Classic Literature', description: 'Enduring works of literary excellence', created_at: new Date().toISOString() },
                    { id: 4, name: 'Mystery', description: 'Crime and detective fiction', created_at: new Date().toISOString() },
                    { id: 5, name: 'Romance', description: 'Romantic love stories', created_at: new Date().toISOString() },
                    { id: 6, name: 'History', description: 'Non-fiction works about historical events', created_at: new Date().toISOString() },
                    { id: 7, name: 'Biography', description: 'Accounts of individuals lives', created_at: new Date().toISOString() },
                    { id: 8, name: 'Self-Help', description: 'Books for personal development', created_at: new Date().toISOString() }
                ];

                // Sample Books
                const books = [
                    { id: 1, title: 'Harry Potter and the Philosopher\'s Stone', author_id: 1, category_id: 1, isbn: '978-0747532743', quantity: 5, available: 5, description: 'First book in the Harry Potter series.', cover_color: '#8B4513', created_at: new Date().toISOString() },
                    { id: 2, title: 'Harry Potter and the Chamber of Secrets', author_id: 1, category_id: 1, isbn: '978-0747538493', quantity: 4, available: 4, description: 'Second book in the Harry Potter series.', cover_color: '#228B22', created_at: new Date().toISOString() },
                    { id: 3, title: '1984', author_id: 2, category_id: 2, isbn: '978-0451524935', quantity: 6, available: 6, description: 'Dystopian social science fiction novel.', cover_color: '#DC143C', created_at: new Date().toISOString() },
                    { id: 4, title: 'Animal Farm', author_id: 2, category_id: 2, isbn: '978-0451526342', quantity: 8, available: 8, description: 'Allegorical novella about revolution.', cover_color: '#4169E1', created_at: new Date().toISOString() },
                    { id: 5, title: 'To Kill a Mockingbird', author_id: 3, category_id: 3, isbn: '978-0061120084', quantity: 3, available: 3, description: 'Novel about racial injustice.', cover_color: '#2E8B57', created_at: new Date().toISOString() },
                    { id: 6, title: 'The Great Gatsby', author_id: 4, category_id: 3, isbn: '978-0743273565', quantity: 5, available: 5, description: 'Novel about the American Dream.', cover_color: '#DAA520', created_at: new Date().toISOString() },
                    { id: 7, title: 'Pride and Prejudice', author_id: 5, category_id: 5, isbn: '978-0141439518', quantity: 4, available: 4, description: 'Romantic novel of manners.', cover_color: '#9370DB', created_at: new Date().toISOString() },
                    { id: 8, title: 'Adventures of Huckleberry Finn', author_id: 6, category_id: 3, isbn: '978-0142437230', quantity: 6, available: 6, description: 'Novel about a boy and a runaway slave.', cover_color: '#20B2AA', created_at: new Date().toISOString() },
                    { id: 9, title: 'Great Expectations', author_id: 7, category_id: 3, isbn: '978-0141439563', quantity: 3, available: 3, description: 'Novel about an orphan named Pip.', cover_color: '#8B0000', created_at: new Date().toISOString() },
                    { id: 10, title: 'Wuthering Heights', author_id: 8, category_id: 5, isbn: '978-0141439556', quantity: 4, available: 4, description: 'Novel of passion and revenge.', cover_color: '#4B0082', created_at: new Date().toISOString() },
                    { id: 11, title: 'Harry Potter and the Prisoner of Azkaban', author_id: 1, category_id: 1, isbn: '978-0747542155', quantity: 4, available: 4, description: 'Third book in the Harry Potter series.', cover_color: '#1a1a2e', created_at: new Date().toISOString() },
                    { id: 12, title: 'Harry Potter and the Goblet of Fire', author_id: 1, category_id: 1, isbn: '978-0747549088', quantity: 3, available: 3, description: 'Fourth book in the Harry Potter series.', cover_color: '#000000', created_at: new Date().toISOString() }
                ];

                // Sample Users
                const users = [
                    { id: 1, name: 'Admin User', email: 'admin@lms.com', password: 'admin123', role: 'admin', status: 'active', created_at: new Date().toISOString() },
                    { id: 2, name: 'Demo User', email: 'user@lms.com', password: 'user123', role: 'user', status: 'active', created_at: new Date().toISOString() },
                    { id: 3, name: 'Jane Smith', email: 'jane@example.com', password: 'user123', role: 'user', status: 'active', created_at: new Date().toISOString() },
                    { id: 4, name: 'Bob Johnson', email: 'bob@example.com', password: 'user123', role: 'user', status: 'inactive', created_at: new Date().toISOString() },
                    { id: 5, name: 'Alice Brown', email: 'alice@example.com', password: 'user123', role: 'user', status: 'active', created_at: new Date().toISOString() }
                ];

                // Sample Issued Books
                const issuedBooks = [
                    { id: 1, book_id: 1, user_id: 2, issue_date: '2024-01-15', due_date: '2024-02-15', return_date: null, status: 'issued', fine: 0 },
                    { id: 2, book_id: 3, user_id: 2, issue_date: '2024-01-10', due_date: '2024-02-10', return_date: '2024-02-08', status: 'returned', fine: 0 },
                    { id: 3, book_id: 5, user_id: 3, issue_date: '2024-01-20', due_date: '2024-02-20', return_date: null, status: 'issued', fine: 0 },
                    { id: 4, book_id: 7, user_id: 3, issue_date: '2024-01-05', due_date: '2024-02-05', return_date: '2024-02-01', status: 'returned', fine: 0 },
                    { id: 5, book_id: 2, user_id: 5, issue_date: '2024-01-25', due_date: '2024-02-25', return_date: null, status: 'issued', fine: 5 }
                ];

                // Store initial data
                this.setData(this.STORAGE_KEYS.AUTHORS, authors);
                this.setData(this.STORAGE_KEYS.CATEGORIES, categories);
                this.setData(this.STORAGE_KEYS.BOOKS, books);
                this.setData(this.STORAGE_KEYS.USERS, users);
                this.setData(this.STORAGE_KEYS.ISSUED_BOOKS, issuedBooks);
                this.setData(this.STORAGE_KEYS.FINES, []);
                this.setData(this.STORAGE_KEYS.NOTIFICATIONS, []);
            },

            getData: function(key) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },

            setData: function(key, data) {
                localStorage.setItem(key, JSON.stringify(data));
            },

            getUsers: function() { return this.getData(this.STORAGE_KEYS.USERS) || []; },
            getBooks: function() { return this.getData(this.STORAGE_KEYS.BOOKS) || []; },
            getAuthors: function() { return this.getData(this.STORAGE_KEYS.AUTHORS) || []; },
            getCategories: function() { return this.getData(this.STORAGE_KEYS.CATEGORIES) || []; },
            getIssuedBooks: function() { return this.getData(this.STORAGE_KEYS.ISSUED_BOOKS) || []; },
            getFines: function() { return this.getData(this.STORAGE_KEYS.FINES) || []; },
            getNotifications: function() { return this.getData(this.STORAGE_KEYS.NOTIFICATIONS) || []; },

            getUserById: function(id) {
                const users = this.getUsers();
                return users.find(user => user.id === id);
            },

            getUserByEmail: function(email) {
                const users = this.getUsers();
                return users.find(user => user.email === email);
            },

            getBookById: function(id) {
                const books = this.getBooks();
                return books.find(book => book.id === id);
            },

            getAuthorById: function(id) {
                const authors = this.getAuthors();
                return authors.find(author => author.id === id);
            },

            getCategoryById: function(id) {
                const categories = this.getCategories();
                return categories.find(category => category.id === id);
            },

            addUser: function(user) {
                const users = this.getUsers();
                const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
                const newUser = { ...user, id: newId, status: 'active', created_at: new Date().toISOString() };
                users.push(newUser);
                this.setData(this.STORAGE_KEYS.USERS, users);
                return newUser;
            },

            addBook: function(book) {
                const books = this.getBooks();
                const newId = books.length > 0 ? Math.max(...books.map(b => b.id)) + 1 : 1;
                const newBook = { ...book, id: newId, available: book.quantity, created_at: new Date().toISOString() };
                books.push(newBook);
                this.setData(this.STORAGE_KEYS.BOOKS, books);
                return newBook;
            },

            addAuthor: function(author) {
                const authors = this.getAuthors();
                const newId = authors.length > 0 ? Math.max(...authors.map(a => a.id)) + 1 : 1;
                const newAuthor = { ...author, id: newId, created_at: new Date().toISOString() };
                authors.push(newAuthor);
                this.setData(this.STORAGE_KEYS.AUTHORS, authors);
                return newAuthor;
            },

            addCategory: function(category) {
                const categories = this.getCategories();
                const newId = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
                const newCategory = { ...category, id: newId, created_at: new Date().toISOString() };
                categories.push(newCategory);
                this.setData(this.STORAGE_KEYS.CATEGORIES, categories);
                return newCategory;
            },

            deleteBook: function(id) {
                const books = this.getBooks().filter(book => book.id !== id);
                this.setData(this.STORAGE_KEYS.BOOKS, books);
                return true;
            },

            deleteAuthor: function(id) {
                const authors = this.getAuthors().filter(author => author.id !== id);
                this.setData(this.STORAGE_KEYS.AUTHORS, authors);
                return true;
            },

            deleteCategory: function(id) {
                const categories = this.getCategories().filter(category => category.id !== id);
                this.setData(this.STORAGE_KEYS.CATEGORIES, categories);
                return true;
            },

            deleteUser: function(id) {
                const users = this.getUsers().filter(user => user.id !== id);
                this.setData(this.STORAGE_KEYS.USERS, users);
                return true;
            },

            updateUser: function(id, updates) {
                const users = this.getUsers();
                const index = users.findIndex(user => user.id === id);
                if (index !== -1) {
                    users[index] = { ...users[index], ...updates };
                    this.setData(this.STORAGE_KEYS.USERS, users);
                    return true;
                }
                return false;
            },

            issueBook: function(bookId, userId) {
                const issuedBooks = this.getIssuedBooks();
                const books = this.getBooks();
                
                const book = this.getBookById(bookId);
                if (!book || book.available < 1) {
                    return { success: false, message: 'Book not available' };
                }

                const newId = issuedBooks.length > 0 ? Math.max(...issuedBooks.map(ib => ib.id)) + 1 : 1;
                const issueDate = new Date();
                const dueDate = new Date();
                dueDate.setDate(dueDate.getDate() + 30);

                const newIssue = {
                    id: newId,
                    book_id: bookId,
                    user_id: userId,
                    issue_date: issueDate.toISOString().split('T')[0],
                    due_date: dueDate.toISOString().split('T')[0],
                    return_date: null,
                    status: 'issued',
                    fine: 0
                };

                issuedBooks.push(newIssue);
                this.setData(this.STORAGE_KEYS.ISSUED_BOOKS, issuedBooks);

                // Update book availability
                const bookIndex = books.findIndex(b => b.id === bookId);
                books[bookIndex].available = books[bookIndex].available - 1;
                this.setData(this.STORAGE_KEYS.BOOKS, books);

                return { success: true, message: 'Book issued successfully', issue: newIssue };
            },

            returnBook: function(issueId) {
                const issuedBooks = this.getIssuedBooks();
                const books = this.getBooks();
                const index = issuedBooks.findIndex(ib => ib.id === issueId);
                
                if (index === -1) {
                    return { success: false, message: 'Issue record not found' };
                }

                const issue = issuedBooks[index];
                if (issue.status === 'returned') {
                    return { success: false, message: 'Book already returned' };
                }

                const dueDate = new Date(issue.due_date);
                const returnDate = new Date();
                const daysOverdue = Math.floor((returnDate - dueDate) / (1000 * 60 * 60 * 24));
                const fine = daysOverdue > 0 ? daysOverdue * 1 : 0;

                issuedBooks[index] = {
                    ...issue,
                    return_date: returnDate.toISOString().split('T')[0],
                    status: 'returned',
                    fine: fine
                };

                this.setData(this.STORAGE_KEYS.ISSUED_BOOKS, issuedBooks);

                // Update book availability
                const bookIndex = books.findIndex(b => b.id === issue.book_id);
                books[bookIndex].available = books[bookIndex].available + 1;
                this.setData(this.STORAGE_KEYS.BOOKS, books);

                return { success: true, message: 'Book returned successfully', fine: fine };
            },

            getUserIssuedBooks: function(userId) {
                const issuedBooks = this.getIssuedBooks();
                return issuedBooks.filter(ib => ib.user_id === userId);
            },

            getAvailableBooks: function() {
                const books = this.getBooks();
                return books.filter(book => book.available > 0);
            },

            searchBooks: function(query) {
                const books = this.getBooks();
                const queryLower = query.toLowerCase();

                return books.filter(book => {
                    const author = this.getAuthorById(book.author_id);
                    const category = this.getCategoryById(book.category_id);
                    
                    return (
                        book.title.toLowerCase().includes(queryLower) ||
                        book.isbn.toLowerCase().includes(queryLower) ||
                        (author && author.name.toLowerCase().includes(queryLower)) ||
                        (category && category.name.toLowerCase().includes(queryLower))
                    );
                });
            },

            getStats: function() {
                const books = this.getBooks();
                const users = this.getUsers();
                const issuedBooks = this.getIssuedBooks();
                const authors = this.getAuthors();
                const categories = this.getCategories();

                const activeUsers = users.filter(u => u.status === 'active' && u.role === 'user').length;
                const totalBooks = books.reduce((sum, b) => sum + b.quantity, 0);
                const availableBooks = books.reduce((sum, b) => sum + b.available, 0);
                const issuedBooksCount = issuedBooks.filter(ib => ib.status === 'issued').length;
                const overdueBooks = issuedBooks.filter(ib => {
                    if (ib.status === 'returned') return false;
                    return new Date(ib.due_date) < new Date();
                }).length;

                return {
                    totalBooks,
                    availableBooks,
                    issuedBooks: issuedBooksCount,
                    overdueBooks,
                    totalUsers: users.filter(u => u.role === 'user').length,
                    activeUsers,
                    totalAuthors: authors.length,
                    totalCategories: categories.length,
                    totalIssued: issuedBooks.length,
                    returnedBooks: issuedBooks.filter(ib => ib.status === 'returned').length
                };
            }
        };

        // ==========================================
        // AUTH MODULE - Handles authentication
        // ==========================================
        const Auth = {
            currentUser: null,

            init: function() {
                this.currentUser = this.getSession();
                return this.currentUser;
            },

            login: function(email, password) {
                const user = DataManager.getUserByEmail(email);
                
                if (!user) {
                    return { success: false, message: 'User not found' };
                }

                if (user.status === 'inactive') {
                    return { success: false, message: 'Account is inactive. Please contact administrator.' };
                }

                if (user.password === password) {
                    this.setSession(user);
                    this.currentUser = user;
                    return { success: true, message: 'Login successful', user: user };
                }

                return { success: false, message: 'Invalid password' };
            },

            register: function(userData) {
                if (!userData.name || !userData.email || !userData.password) {
                    return { success: false, message: 'All fields are required' };
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(userData.email)) {
                    return { success: false, message: 'Invalid email format' };
                }

                const existingUser = DataManager.getUserByEmail(userData.email);
                if (existingUser) {
                    return { success: false, message: 'Email already registered' };
                }

                if (userData.password.length < 6) {
                    return { success: false, message: 'Password must be at least 6 characters' };
                }

                const user = DataManager.addUser({
                    name: userData.name,
                    email: userData.email,
                    password: userData.password,
                    role: 'user',
                    status: 'active'
                });

                return { success: true, message: 'Registration successful', user: user };
            },

            logout: function() {
                this.currentUser = null;
                localStorage.removeItem(DataManager.STORAGE_KEYS.CURRENT_USER);
                Router.navigate('login');
            },

            setSession: function(user) {
                const sessionData = {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    role: user.role,
                    status: user.status,
                    loginTime: new Date().toISOString()
                };
                localStorage.setItem(DataManager.STORAGE_KEYS.CURRENT_USER, JSON.stringify(sessionData));
            },

            getSession: function() {
                const session = localStorage.getItem(DataManager.STORAGE_KEYS.CURRENT_USER);
                return session ? JSON.parse(session) : null;
            },

            isLoggedIn: function() {
                return this.currentUser !== null;
            },

            isAdmin: function() {
                return this.currentUser && this.currentUser.role === 'admin';
            },

            isUser: function() {
                return this.currentUser && this.currentUser.role === 'user';
            }
        };

        // ==========================================
        // APP MODULE - UI and helper functions
        // ==========================================
        const App = {
            toastContainer: null,

            init: function() {
                this.createToastContainer();
            },

            createToastContainer: function() {
                this.toastContainer = document.getElementById('toast-container');
            },

            showToast: function(message, type = 'info', duration = 3000) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const icons = {
                    success: '',
                    error: '',
                    warning: '',
                    info: ''
                };

                toast.innerHTML = `
                    <span style="font-size: 18px;">${icons[type] || icons.info}</span>
                    <span>${message}</span>
                `;

                this.toastContainer.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            },

            formatDate: function(dateString) {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(dateString).toLocaleDateString('en-US', options);
            },

            renderStats: function(stats) {
                return `
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="fas fa-book"></i></div>
                        <div class="stat-info">
                            <h3>${stats.totalBooks}</h3>
                            <p>Total Books</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-info">
                            <h3>${stats.availableBooks}</h3>
                            <p>Available Books</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange"><i class="fas fa-clipboard-check"></i></div>
                        <div class="stat-info">
                            <h3>${stats.issuedBooks}</h3>
                            <p>Issued Books</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="stat-info">
                            <h3>${stats.overdueBooks}</h3>
                            <p>Overdue Books</p>
                        </div>
                    </div>
                `;
            },

            renderEmptyState: function(icon, title, message) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-${icon}"></i>
                        <h3>${title}</h3>
                        <p>${message}</p>
                    </div>
                `;
            }
        };

        // ==========================================
        // BOOKS MODULE - Book management
        // ==========================================
        const Books = {
            search: function() {
                const query = document.getElementById('book-search').value.toLowerCase();
                const books = DataManager.getBooks();
                const tbody = document.getElementById('books-table');
                
                const filteredBooks = books.filter(book => {
                    const author = DataManager.getAuthorById(book.author_id);
                    const category = DataManager.getCategoryById(book.category_id);
                    return (
                        book.title.toLowerCase().includes(query) ||
                        book.isbn.toLowerCase().includes(query) ||
                        (author && author.name.toLowerCase().includes(query))
                    );
                });

                if (filteredBooks.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center">No books found</td></tr>';
                    return;
                }

                tbody.innerHTML = filteredBooks.map(book => {
                    const author = DataManager.getAuthorById(book.author_id);
                    const category = DataManager.getCategoryById(book.category_id);
                    return `
                        <tr>
                            <td>${book.title}</td>
                            <td>${author ? author.name : 'N/A'}</td>
                            <td>${category ? category.name : 'N/A'}</td>
                            <td>${book.isbn}</td>
                            <td><span class="status ${book.available > 0 ? 'status-active' : 'status-inactive'}">${book.available} / ${book.quantity}</span></td>
                            <td class="actions">
                                <button class="delete-btn" onclick="Books.deleteBook(${book.id})"><i class="fas fa-trash"></i></button>
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            browseSearch: function() {
                const query = document.getElementById('browse-search').value.toLowerCase();
                const books = DataManager.getBooks();
                const grid = document.getElementById('books-grid');
                
                const filteredBooks = books.filter(book => {
                    const author = DataManager.getAuthorById(book.author_id);
                    return (
                        book.title.toLowerCase().includes(query) ||
                        book.isbn.toLowerCase().includes(query) ||
                        (author && author.name.toLowerCase().includes(query))
                    );
                });

                if (filteredBooks.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><i class="fas fa-book"></i><h3>No Books Found</h3><p>Try a different search term</p></div>';
                    return;
                }

                grid.innerHTML = filteredBooks.map(book => {
                    const author = DataManager.getAuthorById(book.author_id);
                    return `
                        <div class="book-card">
                            <div class="book-cover" style="background: ${book.cover_color || '#667eea'}">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="book-info">
                                <h4>${book.title}</h4>
                                <p>${author ? author.name : 'Unknown'}</p>
                                <p class="availability ${book.available > 0 ? 'available' : 'unavailable'}">
                                    ${book.available > 0 ? book.available + ' available' : 'Not available'}
                                </p>
                            </div>
                        </div>
                    `;
                }).join('');
            },

            advancedSearch: function() {
                const title = document.getElementById('search-title').value.toLowerCase();
                const authorId = document.getElementById('search-author').value;
                const categoryId = document.getElementById('search-category').value;
                const isbn = document.getElementById('search-isbn').value.toLowerCase();

                let books = DataManager.getBooks();

                if (title) {
                    books = books.filter(b => b.title.toLowerCase().includes(title));
                }
                if (authorId) {
                    books = books.filter(b => b.author_id === parseInt(authorId));
                }
                if (categoryId) {
                    books = books.filter(b => b.category_id === parseInt(categoryId));
                }
                if (isbn) {
                    books = books.filter(b => b.isbn.toLowerCase().includes(isbn));
                }

                const results = document.getElementById('search-results');
                
                if (books.length === 0) {
                    results.innerHTML = '<div class="empty-state"><i class="fas fa-search"></i><h3>No Results</h3><p>Try different search criteria</p></div>';
                    return;
                }

                results.innerHTML = `
                    <div class="books-grid">
                        ${books.map(book => {
                            const author = DataManager.getAuthorById(book.author_id);
                            const category = DataManager.getCategoryById(book.category_id);
                            return `
                                <div class="book-card">
                                    <div class="book-cover" style="background: ${book.cover_color || '#667eea'}">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="book-info">
                                        <h4>${book.title}</h4>
                                        <p>${author ? author.name : 'Unknown'}</p>
                                        <p>${category ? category.name : 'N/A'}</p>
                                        <p class="availability ${book.available > 0 ? 'available' : 'unavailable'}">
                                            ${book.available > 0 ? book.available + ' available' : 'Not available'}
                                        </p>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },

            deleteBook: function(id) {
                if (confirm('Are you sure you want to delete this book?')) {
                    DataManager.deleteBook(id);
                    App.showToast('Book deleted successfully', 'success');
                    this.search();
                }
            },

            populateForms: function() {
                const authors = DataManager.getAuthors();
                const categories = DataManager.getCategories();
                const users = DataManager.getUsers().filter(u => u.role === 'user' && u.status === 'active');
                const availableBooks = DataManager.getAvailableBooks();

                // Populate author select
                const authorSelects = ['book-author', 'search-author'];
                authorSelects.forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        select.innerHTML = id === 'search-author' ? '<option value="">All Authors</option>' : '<option value="">Select Author</option>';
                        authors.forEach(a => {
                            select.innerHTML += `<option value="${a.id}">${a.name}</option>`;
                        });
                    }
                });

                // Populate category select
                const categorySelects = ['book-category', 'search-category'];
                categorySelects.forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        select.innerHTML = id === 'search-category' ? '<option value="">All Categories</option>' : '<option value="">Select Category</option>';
                        categories.forEach(c => {
                            select.innerHTML += `<option value="${c.id}">${c.name}</option>`;
                        });
                    }
                });

                // Populate user select for issue book
                const userSelect = document.getElementById('issue-user');
                if (userSelect) {
                    userSelect.innerHTML = '<option value="">Select User</option>';
                    users.forEach(u => {
                        userSelect.innerHTML += `<option value="${u.id}">${u.name}</option>`;
                    });
                }

                // Populate book select for issue book
                const bookSelect = document.getElementById('issue-book');
                if (bookSelect) {
                    bookSelect.innerHTML = '<option value="">Select Book</option>';
                    availableBooks.forEach(b => {
                        bookSelect.innerHTML += `<option value="${b.id}">${b.title}</option>`;
                    });
                }
            }
        };

        // ==========================================
        // ROUTER MODULE - Page navigation
        // ==========================================
        const Router = {
            pages: ['login', 'register', 'admin-dashboard', 'user-dashboard', 'manage-books', 'browse-books', 'search', 'add-book', 'add-author', 'add-category', 'issue-book', 'issued-books', 'users', 'my-issued', 'analytics', 'profile', 'notifications'],

            navigate: function(page) {
                // Hide all pages
                document.querySelectorAll('.page-section').forEach(p => p.style.display = 'none');
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('register-page').style.display = 'none';
                document.getElementById('dashboard-container').style.display = 'none';

                if (page === 'login') {
                    document.getElementById('login-page').style.display = 'flex';
                    return;
                }

                if (page === 'register') {
                    document.getElementById('register-page').style.display = 'flex';
                    return;
                }

                // Protected pages require login
                if (!Auth.isLoggedIn()) {
                    document.getElementById('login-page').style.display = 'flex';
                    return;
                }

                document.getElementById('dashboard-container').style.display = 'block';

                // Update sidebar
                this.updateSidebar();

                // Show requested page
                const pageId = page + '-page';
                const pageElement = document.getElementById(pageId);
                
                if (pageElement) {
                    pageElement.style.display = 'block';
                }

                // Page specific actions
                this.loadPage(page);
            },

            updateSidebar: function() {
                const isAdmin = Auth.isAdmin();
                const nav = document.getElementById('sidebar-nav');
                
                let navHTML = `
                    <div class="sidebar-section">Main</div>
                    <a onclick="Router.navigate('${isAdmin ? 'admin' : 'user'}-dashboard')" class="active">
                        <i class="fas fa-home"></i><span>Dashboard</span>
                    </a>
                `;

                if (isAdmin) {
                    navHTML += `
                        <div class="sidebar-section">Management</div>
                        <a onclick="Router.navigate('manage-books')"><i class="fas fa-book"></i><span>Books</span></a>
                        <a onclick="Router.navigate('add-book')"><i class="fas fa-plus-circle"></i><span>Add Book</span></a>
                        <a onclick="Router.navigate('add-author')"><i class="fas fa-pen-fancy"></i><span>Add Author</span></a>
                        <a onclick="Router.navigate('add-category')"><i class="fas fa-tags"></i><span>Add Category</span></a>
                        <a onclick="Router.navigate('issue-book')"><i class="fas fa-clipboard-list"></i><span>Issue Book</span></a>
                        <div class="sidebar-section">Users</div>
                        <a onclick="Router.navigate('users')"><i class="fas fa-users"></i><span>Users</span></a>
                        <a onclick="Router.navigate('issued-books')"><i class="fas fa-clipboard-check"></i><span>Issued Books</span></a>
                        <div class="sidebar-section">Reports</div>
                        <a onclick="Router.navigate('analytics')"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
                    `;
                } else {
                    navHTML += `
                        <div class="sidebar-section">Library</div>
                        <a onclick="Router.navigate('browse-books')"><i class="fas fa-book-open"></i><span>Browse Books</span></a>
                        <a onclick="Router.navigate('search')"><i class="fas fa-search-plus"></i><span>Search</span></a>
                        <a onclick="Router.navigate('my-issued')"><i class="fas fa-clipboard-list"></i><span>My Books</span></a>
                    `;
                }

                navHTML += `
                    <div class="sidebar-section">Account</div>
                    <a onclick="Router.navigate('profile')"><i class="fas fa-user"></i><span>Profile</span></a>
                    <a onclick="Router.navigate('notifications')"><i class="fas fa-bell"></i><span>Notifications</span></a>
                `;

                nav.innerHTML = navHTML;

                // Update user info
                document.getElementById('user-avatar').textContent = Auth.currentUser.name.charAt(0).toUpperCase();
                document.getElementById('user-name').textContent = Auth.currentUser.name;
                document.getElementById('user-role').textContent = Auth.isAdmin() ? 'Administrator' : 'Member';
            },

            loadPage: function(page) {
                const titles = {
                    'admin-dashboard': 'Dashboard',
                    'user-dashboard': 'Dashboard',
                    'manage-books': 'Manage Books',
                    'browse-books': 'Browse Books',
                    'search': 'Search Books',
                    'add-book': 'Add Book',
                    'add-author': 'Add Author',
                    'add-category': 'Add Category',
                    'issue-book': 'Issue Book',
                    'issued-books': 'Issued Books',
                    'users': 'Registered Users',
                    'my-issued': 'My Issued Books',
                    'analytics': 'Analytics',
                    'profile': 'My Profile',
                    'notifications': 'Notifications'
                };

                document.getElementById('page-title').textContent = titles[page] || 'Dashboard';

                switch (page) {
                    case 'admin-dashboard':
                        this.loadAdminDashboard();
                        break;
                    case 'user-dashboard':
                        this.loadUserDashboard();
                        break;
                    case 'manage-books':
                        Books.search();
                        break;
                    case 'browse-books':
                        Books.browseSearch();
                        break;
                    case 'users':
                        this.loadUsers();
                        break;
                    case 'issued-books':
                        this.loadIssuedBooks();
                        break;
                    case 'my-issued':
                        this.loadMyIssuedBooks();
                        break;
                    case 'analytics':
                        this.loadAnalytics();
                        break;
                    case 'profile':
                        this.loadProfile();
                        break;
                }
            },

            loadAdminDashboard: function() {
                const stats = DataManager.getStats();
                document.getElementById('stats-grid').innerHTML = App.renderStats(stats);

                // Recent Issues
                const issuedBooks = DataManager.getIssuedBooks().slice(-5).reverse();
                const recentIssues = document.getElementById('recent-issues');
                
                if (issuedBooks.length === 0) {
                    recentIssues.innerHTML = App.renderEmptyState('clipboard-check', 'No Issued Books', 'There are no books issued yet.');
                } else {
                    recentIssues.innerHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Book</th>
                                    <th>User</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${issuedBooks.map(issue => {
                                    const book = DataManager.getBookById(issue.book_id);
                                    const user = DataManager.getUserById(issue.user_id);
                                    return `
                                        <tr>
                                            <td>${book ? book.title : 'Unknown'}</td>
                                            <td>${user ? user.name : 'Unknown'}</td>
                                            <td><span class="status status-${issue.status}">${issue.status}</span></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                }

                // Recent Users
                const users = DataManager.getUsers().filter(u => u.role === 'user').slice(-5).reverse();
                const recentUsers = document.getElementById('recent-users');
                
                if (users.length === 0) {
                    recentUsers.innerHTML = App.renderEmptyState('users', 'No Users', 'There are no registered users yet.');
                } else {
                    recentUsers.innerHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.map(user => `
                                    <tr>
                                        <td>${user.name}</td>
                                        <td>${user.email}</td>
                                        <td><span class="status status-${user.status}">${user.status}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
            },

            loadUserDashboard: function() {
                const stats = DataManager.getStats();
                const userIssued = DataManager.getUserIssuedBooks(Auth.currentUser.id);
                const userIssuedCount = userIssued.filter(ib => ib.status === 'issued').length;

                document.getElementById('user-stats-grid').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-icon blue"><i class="fas fa-book"></i></div>
                        <div class="stat-info">
                            <h3>${stats.totalBooks}</h3>
                            <p>Total Books</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-info">
                            <h3>${stats.availableBooks}</h3>
                            <p>Available</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange"><i class="fas fa-clipboard-list"></i></div>
                        <div class="stat-info">
                            <h3>${userIssuedCount}</h3>
                            <p>My Issued Books</p>
                        </div>
                    </div>
                `;

                // My Issued Books
                const myIssued = document.getElementById('my-issued-books');
                const userBooks = DataManager.getUserIssuedBooks(Auth.currentUser.id);
                
                if (userBooks.length === 0) {
                    myIssued.innerHTML = App.renderEmptyState('clipboard-check', 'No Books Issued', 'You haven\'t issued any books yet.');
                } else {
                    myIssued.innerHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Book</th>
                                    <th>Issue Date</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${userBooks.map(issue => {
                                    const book = DataManager.getBookById(issue.book_id);
                                    return `
                                        <tr>
                                            <td>${book ? book.title : 'Unknown'}</td>
                                            <td>${App.formatDate(issue.issue_date)}</td>
                                            <td>${App.formatDate(issue.due_date)}</td>
                                            <td><span class="status status-${issue.status}">${issue.status}</span></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                }
            },

            loadUsers: function() {
                const users = DataManager.getUsers().filter(u => u.role === 'user');
                const tbody = document.getElementById('users-table');

                tbody.innerHTML = users.map(user => `
                    <tr>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td><span class="status status-${user.status}">${user.status}</span></td>
                        <td>${App.formatDate(user.created_at)}</td>
                        <td class="actions">
                            <button class="delete-btn" onclick="DataManager.deleteUser(${user.id}); Router.loadPage('users');"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `).join('');
            },

            loadIssuedBooks: function() {
                const issuedBooks = DataManager.getIssuedBooks();
                const tbody = document.getElementById('issued-books-table');

                tbody.innerHTML = issuedBooks.map(issue => {
                    const book = DataManager.getBookById(issue.book_id);
                    const user = DataManager.getUserById(issue.user_id);
                    return `
                        <tr>
                            <td>${book ? book.title : 'Unknown'}</td>
                            <td>${user ? user.name : 'Unknown'}</td>
                            <td>${App.formatDate(issue.issue_date)}</td>
                            <td>${App.formatDate(issue.due_date)}</td>
                            <td><span class="status status-${issue.status}">${issue.status}</span></td>
                            <td>
                                ${issue.status === 'issued' ? `<button class="btn btn-success btn-sm" onclick="Router.returnBook(${issue.id})">Return</button>` : '-'}
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            returnBook: function(issueId) {
                const result = DataManager.returnBook(issueId);
                if (result.success) {
                    App.showToast('Book returned successfully!' + (result.fine > 0 ? ` Fine: $${result.fine}` : ''), 'success');
                    this.loadIssuedBooks();
                } else {
                    App.showToast(result.message, 'error');
                }
            },

            loadMyIssuedBooks: function() {
                const issuedBooks = DataManager.getUserIssuedBooks(Auth.currentUser.id);
                const tbody = document.getElementById('my-issued-table');

                tbody.innerHTML = issuedBooks.map(issue => {
                    const book = DataManager.getBookById(issue.book_id);
                    return `
                        <tr>
                            <td>${book ? book.title : 'Unknown'}</td>
                            <td>${App.formatDate(issue.issue_date)}</td>
                            <td>${App.formatDate(issue.due_date)}</td>
                            <td><span class="status status-${issue.status}">${issue.status}</span></td>
                            <td>
                                ${issue.status === 'issued' ? `<button class="btn btn-success btn-sm" onclick="Router.returnMyBook(${issue.id})">Return</button>` : '-'}
                            </td>
                        </tr>
                    `;
                }).join('');
            },

            returnMyBook: function(issueId) {
                const result = DataManager.returnBook(issueId);
                if (result.success) {
                    App.showToast('Book returned successfully!' + (result.fine > 0 ? ` Fine: $${result.fine}` : ''), 'success');
                    this.loadMyIssuedBooks();
                } else {
                    App.showToast(result.message, 'error');
                }
            },

            loadAnalytics: function() {
                const stats = DataManager.getStats();
                const categories = DataManager.getCategories();
                const authors = DataManager.getAuthors();

                document.getElementById('analytics-stats').innerHTML = `
                    <div class="report-item">
                        <i class="fas fa-book" style="color: var(--primary-color);"></i>
                        <div><h4>Total Books</h4><p>${stats.totalBooks}</p></div>
                    </div>
                    <div class="report-item">
                        <i class="fas fa-users" style="color: var(--success-color);"></i>
                        <div><h4>Total Users</h4><p>${stats.totalUsers}</p></div>
                    </div>
                    <div class="report-item">
                        <i class="fas fa-clipboard-list" style="color: var(--warning-color);"></i>
                        <div><h4>Books Issued</h4><p>${stats.issuedBooks}</p></div>
                    </div>
                    <div class="report-item">
                        <i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i>
                        <div><h4>Overdue Books</h4><p>${stats.overdueBooks}</p></div>
                    </div>
                    <div class="report-item">
                        <i class="fas fa-user-edit" style="color: var(--info-color);"></i>
                        <div><h4>Authors</h4><p>${stats.totalAuthors}</p></div>
                    </div>
                    <div class="report-item">
                        <i class="fas fa-tags" style="color: var(--secondary-color);"></i>
                        <div><h4>Categories</h4><p>${stats.totalCategories}</p></div>
                    </div>
                `;

                // Category chart
                const books = DataManager.getBooks();
                const categoryData = categories.map(cat => {
                    const catBooks = books.filter(b => b.category_id === cat.id);
                    return { name: cat.name, count: catBooks.reduce((sum, b) => sum + b.quantity, 0) };
                }).filter(c => c.count > 0);

                document.getElementById('category-chart').innerHTML = categoryData.map(cat => `
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div style="flex: 1;">${cat.name}</div>
                        <div style="flex: 2; background: #e2e8f0; border-radius: 5px; height: 20px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; border-radius: 5px; width: ${(cat.count / stats.totalBooks) * 100}%"></div>
                        </div>
                        <div style="margin-left: 10px; width: 40px;">${cat.count}</div>
                    </div>
                `).join('');

                // Author chart
                const authorData = authors.map(author => {
                    const authorBooks = books.filter(b => b.author_id === author.id);
                    return { name: author.name, count: authorBooks.reduce((sum, b) => sum + b.quantity, 0) };
                }).filter(a => a.count > 0).slice(0, 5);

                document.getElementById('author-chart').innerHTML = authorData.map(author => `
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div style="flex: 1;">${author.name}</div>
                        <div style="flex: 2; background: #e2e8f0; border-radius: 5px; height: 20px;">
                            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); height: 100%; border-radius: 5px; width: ${(author.count / stats.totalBooks) * 100}%"></div>
                        </div>
                        <div style="margin-left: 10px; width: 40px;">${author.count}</div>
                    </div>
                `).join('');
            },

            loadProfile: function() {
                document.getElementById('profile-name').value = Auth.currentUser.name;
                document.getElementById('profile-email').value = Auth.currentUser.email;
                document.getElementById('profile-role').value = Auth.isAdmin() ? 'Administrator' : 'User';
            }
        };

        // ==========================================
        // INITIALIZATION
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data
            DataManager.init();
            App.init();
            Auth.init();

            // Check login status
            if (Auth.isLoggedIn()) {
                Router.navigate(Auth.isAdmin() ? 'admin-dashboard' : 'user-dashboard');
            } else {
                Router.navigate('login');
            }

            // Login form
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                const result = Auth.login(email, password);
                
                if (result.success) {
                    App.showToast('Login successful!', 'success');
                    setTimeout(() => {
                        Router.navigate(Auth.isAdmin() ? 'admin-dashboard' : 'user-dashboard');
                    }, 500);
                } else {
                    App.showToast(result.message, 'error');
                }
            });

            // Admin quick login
            document.getElementById('admin-login-btn').addEventListener('click', function() {
                document.getElementById('login-email').value = 'admin@lms.com';
                document.getElementById('login-password').value = 'admin123';
            });

            // Register form
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;
                const confirmPassword = document.getElementById('reg-confirm-password').value;

                if (password !== confirmPassword) {
                    App.showToast('Passwords do not match', 'error');
                    return;
                }

                const result = Auth.register({ name, email, password });
                
                if (result.success) {
                    App.showToast('Registration successful! Please login.', 'success');
                    setTimeout(() => {
                        Router.navigate('login');
                    }, 1000);
                } else {
                    App.showToast(result.message, 'error');
                }
            });

            // Add Book form
            document.getElementById('add-book-form').addEventListener('submit', function(e) {
                e.preventDefault();
                Books.populateForms();
                
                const bookData = {
                    title: document.getElementById('book-title').value,
                    author_id: parseInt(document.getElementById('book-author').value),
                    category_id: parseInt(document.getElementById('book-category').value),
                    isbn: document.getElementById('book-isbn').value,
                    quantity: parseInt(document.getElementById('book-quantity').value),
                    description: document.getElementById('book-description').value,
                    cover_color: '#' + Math.floor(Math.random()*16777215).toString(16)
                };
                
                DataManager.addBook(bookData);
                App.showToast('Book added successfully!', 'success');
                
                // Reset form
                e.target.reset();
            });

            // Add Author form
            document.getElementById('add-author-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const authorData = {
                    name: document.getElementById('author-name').value,
                    email: document.getElementById('author-email').value,
                    bio: document.getElementById('author-bio').value
                };
                
                DataManager.addAuthor(authorData);
                App.showToast('Author added successfully!', 'success');
                e.target.reset();
            });

            // Add Category form
            document.getElementById('add-category-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const categoryData = {
                    name: document.getElementById('category-name').value,
                    description: document.getElementById('category-description').value
                };
                
                DataManager.addCategory(categoryData);
                App.showToast('Category added successfully!', 'success');
                e.target.reset();
            });

            // Issue Book form
            document.getElementById('issue-book-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const userId = parseInt(document.getElementById('issue-user').value);
                const bookId = parseInt(document.getElementById('issue-book').value);
                
                const result = DataManager.issueBook(bookId, userId);
                
                if (result.success) {
                    App.showToast('Book issued successfully!', 'success');
                    e.target.reset();
                    Books.populateForms();
                } else {
                    App.showToast(result.message, 'error');
                }
            });

            // Populate forms on page load
            Books.populateForms();
        });
    </script>
</body>
</html>